{% extends 'base.html' %}
{% block base %}
<!--        内容-->
<h3 class="text-center lead">冠通期货交易权限开通申请系统</h3>
<div class="center">
  <form action="{{ url_for('login') }}" method="post" name="login">

      <div class="form-group">
<!--        <input type="text" class="form-control"  name="userid" placeholder="资金账号">-->
          {{ form.userId(class='form-control',id='userid',required=False) }}
      </div>

      <div class="form-group">
<!--        <input type="text" class="form-control"  name="username" placeholder="姓名（自然人）">-->
          {{ form.userName(class='form-control',id='username',required=False) }}

      </div>

      <div class="form-group"  >
          <a  class="btn btn-success a_width" id="SendCode" onclick="SendCode()" >获取验证码</a>
      </div>

      <div class="form-group">
<!--        <input type="text" class="form-control"  name="code" placeholder="验证码">-->
          {{ form.code(class='form-control',required=False) }}
      </div>

      <div class="form-group">
              <div class="col-sm-offset-2 col-sm-10">
                  <div class="checkbox">
                    <label>
                        {{ form.read_old(class='checkbox',required=False)}}
<!--                      <input type="checkbox" name="read_old">-->
                        我已通过阅读《基础知识学习提示函》，了解相关业务基础知识、业务规则及潜在风险等。
                    </label>
                  </div>
              </div>

      </div>
      <div class="form-group">
          <div>{{ form.csrf_token(id='token') }}</div>
          {{ form.submit(class='btn btn-default a_width') }}
          {{ get_flashed_messages()[0] }}
<!--        <button class="btn btn-default a_width" type="submit">下一步</button>-->
      </div>
    </form>
</div>
<script type="text/javascript">
    function SendCode(){
        var code = $("#SendCode");
        var userid = $("#userid").val();
        var username = $("#username").val();
        var token = $("#token").val();
        var tag = tag_(code,userid,username);
        if (tag){
            $.ajax({
                url:"sendCode",
                data:{userid:userid},
                dataType:"json",
                type:"get",
                // async : false,
                // cache : false,
                success:function(res){
                    debugger;
                    if(res){
                        alert("验证码发送成功");
                    }else{
                    }
                },
                error:function(){
                    alert("验证码发送失败");
                }
            })
        }
    }

    // 验证账号与姓名是否填写
    function tag_(code,userid,username) {

        if(userid && username){
            sleep(code);
            return true
        }else {
            return false
        }
}
	// 等待60s
    function sleep(code) {
        code.attr("disabled", "disabled");
        var time = 60;
	    var set=setInterval(function(){
	        code.html(--time+"秒后重新获取");
	    }, 1000);

	    setTimeout(function(){
            code.attr("disabled",false).html("重新获取验证码");
            clearInterval(set);
	    }, 60000);
    }
</script>
{% endblock %}